<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EmailJSè¨­å®šãƒ†ã‚¹ãƒˆ | æ¡œç”ºä¸­å­¦æ ¡1976å¹´å’æ¥­åŒçª“ä¼š</title>
    <link rel="stylesheet" href="assets/css/styles.css">
    <!-- EmailJS SDK -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <!-- EmailJS Service -->
    <script src="assets/js/emailjs-service.js"></script>
</head>
<body>
    <header>
        <div class="container">
            <h1>EmailJSè¨­å®šãƒ†ã‚¹ãƒˆ</h1>
            <p class="subtitle">ãƒ¡ãƒ¼ãƒ«é€šçŸ¥æ©Ÿèƒ½ã®å‹•ä½œç¢ºèª</p>
        </div>
    </header>

    <main class="page-content">
        <div class="container">
            <div class="content-section">
                <h2>ğŸ”§ è¨­å®šç¢ºèª</h2>
                <div id="config-status" class="form-container">
                    <button onclick="checkConfiguration()" class="submit-button">è¨­å®šçŠ¶æ³ã‚’ç¢ºèª</button>
                    <div id="config-result" style="margin-top: 20px;"></div>
                </div>
            </div>

            <div class="content-section">
                <h2>ğŸ“§ ãƒ†ã‚¹ãƒˆãƒ¡ãƒ¼ãƒ«é€ä¿¡</h2>
                <div class="form-container">
                    <h3>ãŠå•ã„åˆã‚ã›ãƒ•ã‚©ãƒ¼ãƒ ãƒ†ã‚¹ãƒˆ</h3>
                    <form onsubmit="testContactForm(event)">
                        <div class="form-group">
                            <label for="test-name">ãƒ†ã‚¹ãƒˆé€ä¿¡è€…å</label>
                            <input type="text" id="test-name" value="ãƒ†ã‚¹ãƒˆå¤ªéƒ" required>
                        </div>
                        <div class="form-group">
                            <label for="test-email">ãƒ†ã‚¹ãƒˆé€ä¿¡å…ˆãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
                            <input type="email" id="test-email" placeholder="your@email.com" required>
                        </div>
                        <div class="form-group">
                            <label for="test-subject">ãƒ†ã‚¹ãƒˆä»¶å</label>
                            <select id="test-subject" required>
                                <option value="ãƒ†ã‚¹ãƒˆé€ä¿¡">ãƒ†ã‚¹ãƒˆé€ä¿¡</option>
                                <option value="å‚åŠ ã«ã¤ã„ã¦">åŒçª“ä¼šã¸ã®å‚åŠ ã«ã¤ã„ã¦</option>
                                <option value="ãã®ä»–">ãã®ä»–</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="test-message">ãƒ†ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</label>
                            <textarea id="test-message" required>ã“ã‚Œã¯EmailJSæ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§ã™ã€‚</textarea>
                        </div>
                        <button type="submit" class="submit-button">ãŠå•ã„åˆã‚ã›ãƒ†ã‚¹ãƒˆãƒ¡ãƒ¼ãƒ«é€ä¿¡</button>
                    </form>
                </div>

                <div class="form-container" style="margin-top: 30px;">
                    <h3>å‡ºæ¬ ç¢ºèªãƒ•ã‚©ãƒ¼ãƒ ãƒ†ã‚¹ãƒˆ</h3>
                    <form onsubmit="testRSVPForm(event)">
                        <div class="form-group">
                            <label for="test-rsvp-name">ãƒ†ã‚¹ãƒˆå‚åŠ è€…å</label>
                            <input type="text" id="test-rsvp-name" value="ãƒ†ã‚¹ãƒˆèŠ±å­" required>
                        </div>
                        <div class="form-group">
                            <label for="test-rsvp-email">ãƒ†ã‚¹ãƒˆé€ä¿¡å…ˆãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
                            <input type="email" id="test-rsvp-email" placeholder="your@email.com" required>
                        </div>
                        <div class="form-group">
                            <label for="test-rsvp-class">ãƒ†ã‚¹ãƒˆã‚¯ãƒ©ã‚¹</label>
                            <select id="test-rsvp-class">
                                <option value="1çµ„">1çµ„</option>
                                <option value="2çµ„">2çµ„</option>
                                <option value="ãƒ†ã‚¹ãƒˆã‚¯ãƒ©ã‚¹">ãƒ†ã‚¹ãƒˆã‚¯ãƒ©ã‚¹</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="test-rsvp-event">ãƒ†ã‚¹ãƒˆã‚¤ãƒ™ãƒ³ãƒˆ</label>
                            <input type="text" id="test-rsvp-event" value="åŒçª“ä¼šç·ä¼š2025" required>
                        </div>
                        <div class="form-group">
                            <label for="test-rsvp-attendance">å‡ºæ¬ å›ç­”</label>
                            <select id="test-rsvp-attendance" required>
                                <option value="participate">å‚åŠ äºˆå®š</option>
                                <option value="not-participate">ä¸å‚åŠ </option>
                                <option value="undecided">æœªå®š</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="test-rsvp-comment">ãƒ†ã‚¹ãƒˆã‚³ãƒ¡ãƒ³ãƒˆ</label>
                            <textarea id="test-rsvp-comment">ã“ã‚Œã¯EmailJSå‡ºæ¬ ç¢ºèªæ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆã§ã™ã€‚</textarea>
                        </div>
                        <button type="submit" class="submit-button">å‡ºæ¬ ç¢ºèªãƒ†ã‚¹ãƒˆãƒ¡ãƒ¼ãƒ«é€ä¿¡</button>
                    </form>
                </div>

                <div class="form-container" style="margin-top: 30px;">
                    <h3>ç®¡ç†è€…é€šçŸ¥ãƒ†ã‚¹ãƒˆ</h3>
                    <form onsubmit="testAdminNotification(event)">
                        <div class="form-group">
                            <label for="test-admin-type">é€šçŸ¥ã‚¿ã‚¤ãƒ—</label>
                            <select id="test-admin-type" required>
                                <option value="new_contact">æ–°ã—ã„ãŠå•ã„åˆã‚ã›</option>
                                <option value="new_rsvp">æ–°ã—ã„å‡ºæ¬ å›ç­”</option>
                            </select>
                        </div>
                        <button type="submit" class="submit-button">ç®¡ç†è€…é€šçŸ¥ãƒ†ã‚¹ãƒˆãƒ¡ãƒ¼ãƒ«é€ä¿¡</button>
                    </form>
                </div>
            </div>

            <div class="content-section">
                <h2>ğŸ“‹ ãƒ†ã‚¹ãƒˆçµæœ</h2>
                <div id="test-results" class="form-container">
                    <p>ãƒ†ã‚¹ãƒˆçµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p>
                </div>
            </div>

            <div class="content-section">
                <h2>ğŸ“– è¨­å®šã‚¬ã‚¤ãƒ‰</h2>
                <div class="form-container">
                    <p>EmailJSæ©Ÿèƒ½ã‚’ä½¿ç”¨ã™ã‚‹ã«ã¯ã€äº‹å‰ã«EmailJSã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®è¨­å®šãŒå¿…è¦ã§ã™ã€‚</p>
                    <p>è©³ç´°ãªè¨­å®šæ–¹æ³•ã¯ <a href="docs/EmailJS_Setup_Guide.md" target="_blank" style="color: #3182ce; font-weight: bold;">EmailJSè¨­å®šã‚¬ã‚¤ãƒ‰</a> ã‚’ã”è¦§ãã ã•ã„ã€‚</p>
                    
                    <h4>å¿…è¦ãªè¨­å®šé …ç›®:</h4>
                    <ul style="margin-left: 20px; line-height: 1.8;">
                        <li>EmailJSã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ</li>
                        <li>ãƒ¡ãƒ¼ãƒ«ã‚µãƒ¼ãƒ“ã‚¹é€£æºï¼ˆGmailæ¨å¥¨ï¼‰</li>
                        <li>3ã¤ã®ãƒ¡ãƒ¼ãƒ«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä½œæˆ</li>
                        <li>Service IDã¨Public Keyã®è¨­å®š</li>
                    </ul>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2025 æ¡œç”ºä¸­å­¦æ ¡1976å¹´å’æ¥­åŒçª“ä¼š. All rights reserved.</p>
        </div>
    </footer>

    <script>
        // è¨­å®šç¢ºèª
        function checkConfiguration() {
            const config = window.emailService.checkConfiguration();
            const resultDiv = document.getElementById('config-result');
            
            let html = '<h4>ç¾åœ¨ã®è¨­å®šçŠ¶æ³:</h4>';
            html += `<p><strong>åˆæœŸåŒ–çŠ¶æ…‹:</strong> ${config.initialized ? 'âœ… å®Œäº†' : 'âŒ æœªå®Œäº†'}</p>`;
            html += `<p><strong>Service ID:</strong> ${config.serviceId}</p>`;
            html += `<p><strong>Public Key:</strong> ${config.publicKey}</p>`;
            html += '<p><strong>Template IDs:</strong></p>';
            html += '<ul style="margin-left: 20px;">';
            html += `<li>Contact: ${config.templateIds.contact}</li>`;
            html += `<li>RSVP: ${config.templateIds.rsvp}</li>`;
            html += `<li>Admin: ${config.templateIds.admin_notification}</li>`;
            html += '</ul>';

            if (config.publicKey === 'Not set') {
                html += '<p style="color: #e53e3e;"><strong>âš ï¸ EmailJS Public KeyãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</strong><br>';
                html += 'assets/js/emailjs-service.js ãƒ•ã‚¡ã‚¤ãƒ«ã§è¨­å®šã—ã¦ãã ã•ã„ã€‚</p>';
            }

            resultDiv.innerHTML = html;
        }

        // ãŠå•ã„åˆã‚ã›ãƒ•ã‚©ãƒ¼ãƒ ãƒ†ã‚¹ãƒˆ
        async function testContactForm(event) {
            event.preventDefault();
            
            const name = document.getElementById('test-name').value;
            const email = document.getElementById('test-email').value;
            const subject = document.getElementById('test-subject').value;
            const message = document.getElementById('test-message').value;

            const button = event.target.querySelector('.submit-button');
            button.disabled = true;
            button.textContent = 'ãƒ†ã‚¹ãƒˆé€ä¿¡ä¸­...';

            try {
                await window.emailService.sendContactForm({
                    name: name,
                    email: email,
                    subject: subject,
                    message: message
                });

                addTestResult('âœ… ãŠå•ã„åˆã‚ã›ãƒ†ã‚¹ãƒˆãƒ¡ãƒ¼ãƒ«é€ä¿¡æˆåŠŸ', `${email} ã«ãƒ†ã‚¹ãƒˆãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã—ã¾ã—ãŸã€‚`);
            } catch (error) {
                console.error('Test contact form failed:', error);
                addTestResult('âŒ ãŠå•ã„åˆã‚ã›ãƒ†ã‚¹ãƒˆãƒ¡ãƒ¼ãƒ«é€ä¿¡å¤±æ•—', `ã‚¨ãƒ©ãƒ¼: ${error.message}`);
            } finally {
                button.disabled = false;
                button.textContent = 'ãŠå•ã„åˆã‚ã›ãƒ†ã‚¹ãƒˆãƒ¡ãƒ¼ãƒ«é€ä¿¡';
            }
        }

        // å‡ºæ¬ ç¢ºèªãƒ•ã‚©ãƒ¼ãƒ ãƒ†ã‚¹ãƒˆ
        async function testRSVPForm(event) {
            event.preventDefault();
            
            const name = document.getElementById('test-rsvp-name').value;
            const email = document.getElementById('test-rsvp-email').value;
            const userClass = document.getElementById('test-rsvp-class').value;
            const eventName = document.getElementById('test-rsvp-event').value;
            const attendance = document.getElementById('test-rsvp-attendance').value;
            const comment = document.getElementById('test-rsvp-comment').value;

            const button = event.target.querySelector('.submit-button');
            button.disabled = true;
            button.textContent = 'ãƒ†ã‚¹ãƒˆé€ä¿¡ä¸­...';

            try {
                await window.emailService.sendRSVPForm({
                    eventName: eventName,
                    attendance: attendance,
                    comment: comment
                }, {
                    name: name,
                    email: email,
                    class: userClass
                });

                addTestResult('âœ… å‡ºæ¬ ç¢ºèªãƒ†ã‚¹ãƒˆãƒ¡ãƒ¼ãƒ«é€ä¿¡æˆåŠŸ', `${email} ã«ãƒ†ã‚¹ãƒˆãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã—ã¾ã—ãŸã€‚`);
            } catch (error) {
                console.error('Test RSVP form failed:', error);
                addTestResult('âŒ å‡ºæ¬ ç¢ºèªãƒ†ã‚¹ãƒˆãƒ¡ãƒ¼ãƒ«é€ä¿¡å¤±æ•—', `ã‚¨ãƒ©ãƒ¼: ${error.message}`);
            } finally {
                button.disabled = false;
                button.textContent = 'å‡ºæ¬ ç¢ºèªãƒ†ã‚¹ãƒˆãƒ¡ãƒ¼ãƒ«é€ä¿¡';
            }
        }

        // ç®¡ç†è€…é€šçŸ¥ãƒ†ã‚¹ãƒˆ
        async function testAdminNotification(event) {
            event.preventDefault();
            
            const type = document.getElementById('test-admin-type').value;

            const button = event.target.querySelector('.submit-button');
            button.disabled = true;
            button.textContent = 'ãƒ†ã‚¹ãƒˆé€ä¿¡ä¸­...';

            try {
                let testData = {};
                
                if (type === 'new_contact') {
                    testData = {
                        name: 'ãƒ†ã‚¹ãƒˆå¤ªéƒ',
                        email: 'test@example.com',
                        subject: 'ãƒ†ã‚¹ãƒˆä»¶å',
                        message: 'ã“ã‚Œã¯ãƒ†ã‚¹ãƒˆç”¨ã®ãŠå•ã„åˆã‚ã›ã§ã™ã€‚'
                    };
                } else if (type === 'new_rsvp') {
                    testData = {
                        userName: 'ãƒ†ã‚¹ãƒˆèŠ±å­',
                        eventName: 'åŒçª“ä¼šç·ä¼š2025',
                        attendance: 'participate',
                        comment: 'ã“ã‚Œã¯ãƒ†ã‚¹ãƒˆç”¨ã®å‡ºæ¬ å›ç­”ã§ã™ã€‚'
                    };
                }

                await window.emailService.sendAdminNotification(type, testData);

                addTestResult('âœ… ç®¡ç†è€…é€šçŸ¥ãƒ†ã‚¹ãƒˆãƒ¡ãƒ¼ãƒ«é€ä¿¡æˆåŠŸ', `ã‚¿ã‚¤ãƒ—: ${type}`);
            } catch (error) {
                console.error('Test admin notification failed:', error);
                addTestResult('âŒ ç®¡ç†è€…é€šçŸ¥ãƒ†ã‚¹ãƒˆãƒ¡ãƒ¼ãƒ«é€ä¿¡å¤±æ•—', `ã‚¨ãƒ©ãƒ¼: ${error.message}`);
            } finally {
                button.disabled = false;
                button.textContent = 'ç®¡ç†è€…é€šçŸ¥ãƒ†ã‚¹ãƒˆãƒ¡ãƒ¼ãƒ«é€ä¿¡';
            }
        }

        // ãƒ†ã‚¹ãƒˆçµæœè¡¨ç¤º
        function addTestResult(title, message) {
            const resultsDiv = document.getElementById('test-results');
            const timestamp = new Date().toLocaleString('ja-JP');
            
            const resultHtml = `
                <div style="border: 1px solid #e2e8f0; padding: 15px; margin-bottom: 10px; border-radius: 5px; background: ${title.includes('âœ…') ? '#f0f8ff' : '#fff5f5'};">
                    <div style="font-weight: bold; margin-bottom: 5px;">${title}</div>
                    <div style="color: #666; font-size: 0.9rem;">${message}</div>
                    <div style="color: #999; font-size: 0.8rem; margin-top: 5px;">ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ—¥æ™‚: ${timestamp}</div>
                </div>
            `;

            resultsDiv.innerHTML = resultHtml + resultsDiv.innerHTML;
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«è¨­å®šç¢ºèª
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(checkConfiguration, 1000);
        });
    </script>
    <!-- ãƒ†ãƒ¼ãƒåˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½ -->
    <script src="assets/js/theme-switcher.js"></script>
</body>
</html>